<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SDK Lifecycle  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="SDK Lifecycle  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a> (98% documented)</p>
        <p class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" />
        SDK Lifecycle  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Documentation.html">Documentation</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="compatibility.html">Compatibility</a>
              </li>
              <li class="nav-group-task">
                <a href="installation.html">Installation</a>
              </li>
              <li class="nav-group-task">
                <a href="setup.html">Setup</a>
              </li>
              <li class="nav-group-task">
                <a href="authentication.html">Authentication</a>
              </li>
              <li class="nav-group-task">
                <a href="sdk-lifecycle.html">SDK Lifecycle</a>
              </li>
              <li class="nav-group-task">
                <a href="customization.html">Customization</a>
              </li>
              <li class="nav-group-task">
                <a href="entry-points.html">Entry Points</a>
              </li>
              <li class="nav-group-task">
                <a href="transaction-linking.html">Transaction Linking</a>
              </li>
              <li class="nav-group-task">
                <a href="transaction-matching.html">Transaction Matching</a>
              </li>
              <li class="nav-group-task">
                <a href="application-integrations.html">Application Integrations</a>
              </li>
              <li class="nav-group-task">
                <a href="troubleshooting.html">Troubleshooting</a>
              </li>
              <li class="nav-group-task">
                <a href="using-objective-c.html">Using Objective-C</a>
              </li>
              <li class="nav-group-task">
                <a href="data-stored-on-device.html">Data Stored on Device</a>
              </li>
              <li class="nav-group-task">
                <a href="migration-guide.html">Migration Guide</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Authentication%20Reference.html">Authentication Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/PasswordAuthenticator.html">PasswordAuthenticator</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TokenProvider.html">TokenProvider</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Credentials.html">Credentials</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="SDK%20Lifecycle%20Reference.html">SDK Lifecycle Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Sensibill.html">Sensibill</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Customization%20Reference.html">Customization Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/SBBarcodeConfiguration.html">SBBarcodeConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBCaptureViewConfiguration.html">SBCaptureViewConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBCreateFolderControllerConfiguration.html">SBCreateFolderControllerConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBEditReceiptControllerConfiguration.html">SBEditReceiptControllerConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBExpenseTypeSelectionConfiguration.html">SBExpenseTypeSelectionConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBExportsConfiguration.html">SBExportsConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBFolderCollectionViewConfiguration.html">SBFolderCollectionViewConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBFolderReceiptListControllerConfiguration.html">SBFolderReceiptListControllerConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBLoadingViewConfiguration.html">SBLoadingViewConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBNonReceiptEmailConfiguration.html">SBNonReceiptEmailConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBNotificationCentreConfiguration.html">SBNotificationCentreConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptDetailConfiguration.html">SBReceiptDetailConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptListControllerConfiguration.html">SBReceiptListControllerConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptListTableCellConfiguration.html">SBReceiptListTableCellConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptListTableViewConfiguration.html">SBReceiptListTableViewConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptsFilterConfiguration.html">SBReceiptsFilterConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptsListSelectionControllerConfiguration.html">SBReceiptsListSelectionControllerConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBRemindersConfiguration.html">SBRemindersConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSDKColors.html">SBSDKColors</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSDKConfiguration.html">SBSDKConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSDKFontSet.html">SBSDKFontSet</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSDKMoreMenuConfiguration.html">SBSDKMoreMenuConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSDKSearchBarSet.html">SBSDKSearchBarSet</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBTabBarConfiguration.html">SBTabBarConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceiptEditTaxTipsControllerConfiguration.html">SBReceiptEditTaxTipsControllerConfiguration</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Transactions%20Linking%20Reference.html">Transactions Linking Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Transactions%20Linking%20Reference.html#/Transaction">Transaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBLTransaction.html">SBLTransaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TransactionHandler.html">TransactionHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBDataEvent.html">SBDataEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Transactions%20Linking%20Reference.html#/c:SBDataEvent.h@T@SBDataEventReceiptBlock">SBDataEventReceiptBlock</a>
              </li>
              <li class="nav-group-task">
                <a href="Transactions%20Linking%20Reference.html#/c:SBDataEvent.h@T@SBDataEventTransactionBlock">SBDataEventTransactionBlock</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SBTransactionEventType.html">SBTransactionEventType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ReceiptExpenseType.html">ReceiptExpenseType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/SBReceiptEventType.html">SBReceiptEventType</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TransactionError.html">TransactionError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TransactionStatus.html">TransactionStatus</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TransactionType.html">TransactionType</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/TransactionObserver.html">TransactionObserver</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Transaction%20Matching%20Reference.html">Transaction Matching Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/CurrencyCode.html">CurrencyCode</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBExternalAccountTransaction.html">SBExternalAccountTransaction</a>
              </li>
              <li class="nav-group-task">
                <a href="Transaction%20Matching%20Reference.html#/c:@E@SBLOriginalFormat">SBLOriginalFormat</a>
              </li>
              <li class="nav-group-task">
                <a href="Transaction%20Matching%20Reference.html#/c:@E@SBLReceiptExpenseType">SBLReceiptExpenseType</a>
              </li>
              <li class="nav-group-task">
                <a href="Transaction%20Matching%20Reference.html#/c:@E@SBLReceiptType">SBLReceiptType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBReceipt.html">SBReceipt</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBPrivateMetaData.html">SBPrivateMetaData</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SensibillTransactionMatcher.html">SensibillTransactionMatcher</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Entry%20Points.html">Entry Points</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/CaptureFlowCoordinator.html">CaptureFlowCoordinator</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/CaptureFlowCoordinatorDelegate.html">CaptureFlowCoordinatorDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReceiptListViewController.html">ReceiptListViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RecentExportsViewController.html">RecentExportsViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBAnalytics.html">SBAnalytics</a>
              </li>
              <li class="nav-group-task">
                <a href="Entry%20Points.html#/c:SBAnalytics.h@T@SBEventsListener">SBEventsListener</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SBEventListenerInterface.html">SBEventListenerInterface</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SBLReceiptListViewControllerDataSource.html">SBLReceiptListViewControllerDataSource</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBTrackingEvent.html">SBTrackingEvent</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SBSearchReceiptsController.html">SBSearchReceiptsController</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SBViewControllerDelegate.html">SBViewControllerDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SensibillReceiptViewController.html">SensibillReceiptViewController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SensibillSDK.html">SensibillSDK</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ReceiptCaptureManager.html">ReceiptCaptureManager</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Application%20Integrations%20Reference.html">Application Integrations Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/SBNotificationHandler.html">SBNotificationHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Troubleshooting%20Reference.html">Troubleshooting Reference</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/SensibillError.html">SensibillError</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='sdk-lifecycle' class='heading'>SDK Lifecycle</h1>

<p>In order to start interacting with the SDK, the host app must call the <code>start</code> function on the <code><a href="Classes/Sensibill.html#/shared">Sensibill.shared</a></code> singleton object. In order to finish an SDK session and reset the SDK state, the <code>stop</code> function on <code><a href="Classes/Sensibill.html#/shared">Sensibill.shared</a></code> must be called. Once the SDK is stopped, it can be started again.</p>

<p><em>Note</em>: If your app is using <strong>Password Authentication</strong>, start and stop are handled by <code><a href="Classes/PasswordAuthenticator.html">PasswordAuthenticator</a></code> as part of its <code>login</code> and <code>logout</code> functions, and should not be called directly. Follow <a href="authentication.html#password-authentication">Password Authentication</a> instructions instead.</p>
<h2 id='configuring-the-sdk' class='heading'>Configuring the SDK</h2>

<p>By default, the SDK will use the <code>main</code> application bundle to obtain the <code>Sensibill.plist</code> configuration file and pinning certificates. It will also use assets (images and strings) that are provided by the SDK. </p>

<p>If you don&rsquo;t want to include a configuration file and certificates for pinning in the main bundle, or you want to replace SDK assets (images and strings) with custom ones, perform the following steps prior to starting the SDK:</p>

<ol>
<li>Create a bundle as explained in <a href="setup.html#using-external-bundle">Using External Bundle</a> section of <em>Setup</em>.</li>
<li>Create a Bundle instance, pointing to the path of the bundle created in Step 1.</li>
<li>Assign a created instance to the <code>SBSDKConfiguration.sharedInstance().externalBundle</code> configuration parameter prior to other interactions with SDK (e.g. prior to <code>start</code>)</li>
</ol>

<p>In this example, the bundle called <em>SensibillOverride</em> was created to store the Sensibill SDK configuration and assets. The following code ensures the bundle is used by the SDK:</p>
<pre class="highlight swift"><code><span class="k">guard</span> <span class="k">let</span> <span class="nv">bundleURL</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"SensibillOverride"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"bundle"</span><span class="p">),</span>
      <span class="k">let</span> <span class="nv">bundle</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">bundleURL</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Failed to locate a specified bundle</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="kt">SBSDKConfiguration</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()?</span><span class="o">.</span><span class="n">externalBundle</span> <span class="o">=</span> <span class="n">bundle</span>
</code></pre>

<p><em>Note:</em> To find out how to use an <code>externalBundle</code> to store the configuration, see our <a href="setup.html">Setup</a> guide. To use an <code>externalBundle</code> for custom assets, see <a href="customization.html#asset-customization">Asset Customization</a>. You can use an <code>externalBundle</code> for either or both purposes.</p>
<h2 id='starting-the-sdk' class='heading'>Starting the SDK</h2>

<p>The start function will first ensure valid authentication exists for the user (it may call token provider to obtain a new token, or use an existing token if it&rsquo;s valid). Once authentication is valid, it will ensure the information required for interaction with SDK is present on device. This information is <a href="data-stored-on-device.html">cached on device</a>, but is verified and updated from Sensibill&rsquo;s backend on every launch.</p>
<h3 id='prerequisites' class='heading'>Prerequisites</h3>

<ul>
<li>Your <a href="setup.html"><strong>Sensibill.plist</strong></a> must be configured, and a custom token provider must be implemented. See <a href="authentication.html#custom-token-provider-authentication">Custom Token Provider Authentication</a> for more information.</li>
<li>The <code>start</code> function will not work in offline mode, it requires a network connection to succeed.</li>
</ul>
<h3 id='steps' class='heading'>Steps</h3>

<ol>
<li>Create an instance of your custom token provider, and perform all the steps required to make sure the <code>provideTokenReplacement</code> function is ready to be called. 
<em>Note:</em> token provider instance can always be accessed using <code>Sensibill.shared.tokenProvider?</code></li>
<li>Call the <code>start</code> function</li>
<li><code>start</code> is an asynchronous operation. Caller must wait for the start callback to return and succeed before attempting any further interaction with the SDK.</li>
</ol>
<h3 id='example' class='heading'>Example</h3>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">SensibillUI</span>

<span class="c1">// Make sure externalBundle is initialized (if used) - see Configuring SDK section.</span>

<span class="k">let</span> <span class="nv">tokenProvider</span> <span class="o">=</span> <span class="kt">CustomTokenProvider</span><span class="p">()</span>
<span class="c1">// Additional operations required to prepare token provider</span>

<span class="kt">Sensibill</span><span class="o">.</span><span class="nf">start</span><span class="p">(</span><span class="nv">tokenProvider</span><span class="p">:</span> <span class="n">tokenProvider</span><span class="p">,</span> <span class="nv">cacheIdentifier</span><span class="p">:</span> <span class="s">"cacheIdentifier"</span><span class="p">)</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>

    <span class="c1">// Check for an error. If an error is returned, interaction with the SDK will not be possible</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="o">.</span><span class="k">none</span> <span class="o">=</span> <span class="n">error</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Add custom error handling</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// Start interacting with the SDK</span>
<span class="p">}</span>
</code></pre>
<h3 id='cache-identifier' class='heading'>Cache Identifier</h3>

<p>The cache identifier parameter of the <code>start</code> function allows the SDK to keep a unique cache for the user, and support multiple user identities (for example personal and business accounts) cached on the same device. Hence, the cache identifier should be unique for each user identity. A specific format for identifier depends on hosting application usage of SDK.</p>

<p>Examples of good cache identifiers:</p>

<ul>
<li>User email, e.g. <code>john.smith@example.com</code></li>
<li>User email, together with type of account: <code>john.smith@example.com-business</code></li>
</ul>
<h2 id='stopping-the-sdk' class='heading'>Stopping the SDK</h2>

<p>By default the <code>stop</code> function will first attempt to call Sensibill&rsquo;s backend to invalidate the user token and clear the user session. Regardless of the function&rsquo;s success, the local state will be cleared and the result of the remote call will be returned in <code>error</code> of the <code>stop</code> callback.</p>

<p>To disable token invalidation, provide a flag to the stop function: <code>stop(invalidateToken: false) { ... }</code> </p>

<p>Once the <code>stop</code> function is complete, the SDK can be started again. </p>
<h3 id='prerequisites' class='heading'>Prerequisites</h3>

<ul>
<li>For the <code>stop</code> function having a network connection is optimal, but the SDK will stop and reset its state locally regardless.</li>
<li>The stop function cannot run if another <code>stop</code> function is already in progress. Calling stop on already stopped SDK is supported (clears local state only)</li>
</ul>
<h3 id='steps' class='heading'>Steps</h3>

<ol>
<li>Call the <code>stop</code> function</li>
<li><code>stop</code> is an asynchronous operation. The caller must wait for the stop callback to return before attempting to start the SDK again.</li>
</ol>

<p><em>Note:</em> although <code>stop</code> may return an error in the case of a failed remote call (e.g. when the app is offline), the local state will still be cleared. Hence handling an error returned in <code>stop</code> callback is optional.</p>
<h3 id='example' class='heading'>Example</h3>
<pre class="highlight swift"><code> <span class="kd">import</span> <span class="kt">SensibillUI</span>

 <span class="kt">Sensibill</span><span class="o">.</span><span class="n">stop</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>

    <span class="c1">// SDK is stopped</span>
 <span class="p">}</span>
</code></pre>
<h2 id='restarting-the-sdk' class='heading'>Restarting the SDK</h2>

<p>If necessary, you can call the <code>start</code> operation again (with the same or different token provider and cache identifier) once the <code>stop</code> operation is complete.
However, <code>start</code> will fail if you attempt to call <code>start</code> 2 or more times without calling <code>stop</code>.   </p>
<h2 id='error-codes' class='heading'>Error Codes</h2>

<p>Both <code>start</code> and <code>stop</code> may return the following error codes</p>

<ul>
<li><code>sdkCannotStart</code> will be returned by the start callback if the <code>start</code> function was called when the SDK was already starting, running, or stopping. If the SDK is starting or running, call <code>stop</code> first. If the SDK is stopping, wait for the stop operation to complete.</li>
<li><code>sdkStartWasInterrupted</code> will be returned by the start callback, if the <code>stop</code> function was called while the SDK was starting. This result is provided for information only: since the app called stop while the SDK was starting, the result of start callback is presumably no longer important.</li>
<li><code>sdkIsAlreadyStopping</code> will be returned by the stop callback, if <code>stop</code> is called while another stop operation is already running.</li>
</ul>

<p><em>Notes:</em></p>

<ul>
<li>If <code>stop</code> was called while the application is starting, stop may need to wait to be able to interrupt the start.</li>
<li>Two <code>stop</code> operations cannot run simultaneously, but running <code>stop</code> when the SDK is already stopped will return no error and is supported.</li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2021 <a class="link" href="" target="_blank" rel="external"></a>. All rights reserved. (Last updated: 2021-02-03)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.13.5</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
